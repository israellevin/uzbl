# example uzbl config.
# all settings are optional.  you can use uzbl without any config at all (but it won't do much)

set prefix     = /usr/local

# === Shortcuts / Aliases  ===================================================

# Config related events (use the request function):
# request BIND <bind cmd> = <command>
set bind            = request BIND
# request MODE_BIND <mode> <bind cmd> = <command>
set mode_bind       = request MODE_BIND
# request MODE_CONFIG <mode> <key> = <value>
set mode_config     = request MODE_CONFIG
# request ON_EVENT <EVENT_NAME> <command>
set on_event        = request ON_EVENT
# request PROGRESS_CONFIG <key> = <value>
set progress        = request PROGRESS_CONFIG
# request MODMAP <From> <To>
set modmap          = request MODMAP
# request IGNORE_KEY <glob>
set ignore_key      = request IGNORE_KEY
# request MODKEY_ADDITION <key1> <key2> <keyn> <result>
set modkey_addition = request MODKEY_ADDITION

# Action related events (use the event function):
# event TOGGLE_MODES <mode1> <mode2> ... <moden>
set toggle_modes    = event TOGGLE_MODES

set set_mode        = set mode =
set set_status      = set status_message =
set shell_cmd       = sh -c

# Spawn path shortcuts. In spawn the first dir+path match is used in "dir1:dir2:dir3:executable"
set scripts_dir     = $XDG_DATA_HOME/uzbl:@prefix/share/uzbl/examples/data:scripts


# === Handlers ===============================================================

# --- Hardcoded event handlers -----------------------------------------------

# These handlers can't be moved to the new event system yet as we don't
# support events that can wait for a response from a script.
set cookie_handler      = talk_to_socket $XDG_CACHE_HOME/uzbl/cookie_daemon_socket
set scheme_handler      = sync_spawn @scripts_dir/scheme.py

# Open in the same window.
#set new_window         = sh 'echo uri "$8" > $4'
# Open a link in a new window. equivalent to default behavior
set new_window          = sh 'uzbl-browser -g m $8'

# --- Optional dynamic event handlers ----------------------------------------

# Download handler
@on_event   DOWNLOAD_REQUEST    spawn @scripts_dir/download.sh %s \@proxy_url

# Load start handler
@on_event   LOAD_START     @set_status <span foreground="red">-</span>

# Load commit handlers
@on_event   LOAD_COMMIT    @set_status <span background="yellow">|</span>
@on_event   LOAD_COMMIT    script /root/.config/uzbl/scroll-percentage.js
# Reset the keycmd on navigation
@on_event   LOAD_COMMIT    @set_mode

# Load finish handlers
@on_event   LOAD_FINISH    @set_status
@on_event   LOAD_FINISH    spawn @scripts_dir/history.sh

# Switch to insert mode if a (editable) html form is clicked
@on_event   FORM_ACTIVE    @set_mode insert
# Switch to command mode if anything else is clicked
@on_event   ROOT_ACTIVE    @set_mode command

@on_event   GEOMETRY_CHANGED script /root/.config/uzbl/dynzoom.js

# Example CONFIG_CHANGED event handler
#@on_event  CONFIG_CHANGED print Config changed: %1 = %2


# === Behaviour and appearance ===============================================

set show_status       = 0
set status_top        = 0
set status_background = black

set modcmd_style      = weight="bold" foreground="red"
set keycmd_style      = weight="light" foreground="red"
set prompt_style      = foreground="grey"
set cursor_style      = underline="single"
set completion_style  = foreground="green"
set hint_style        = weight="bold"

#set mode_section      = <span background="green" foreground="black">\@[\@mode_indicator]\@</span>
set keycmd_section    = <span \@prompt_style>\@[\@keycmd_prompt]\@</span><span \@modcmd_style>\@modcmd</span><span \@keycmd_style>\@keycmd</span>
set progress_section  = <span foreground="yellow">\@[\@progress_format]\@</span>
set scroll_section    = <span foreground="#00ff00">\@[\@scroll_message]\@</span>
set uri_section       = <span foreground="white">\@[\@uri]\@</span>
set name_section      = <span>\@[\@NAME]\@</span>
set status_section    = <span>\@status_message</span>
set selected_section  = <span foreground="#60ff60">\@[\@SELECTED_URI]\@</span>

set status_format     = <span font_family="monospace">@{status_section}@{keycmd_section} @{selected_section} @{uri_section} @{scroll_section} @{progress_section}</span>

set icon = /usr/local/share/uzbl/examples/data/uzbl/uzbl.png
set title_format_short = \@TITLE
set title_format_long = \@progress_format <\@mode_indicator> [\@{raw_keycmd}] \@scroll_message - \@TITLE

# Progress bar config
@progress width    = 8
# %d = done, %p = pending %c = percent done, %i = int done, %s = spinner,
# %t = percent pending, %o = int pending, %r = sprite scroll
@progress format   = %c
@progress done     = =
@progress pending  =

# Or ride those spinnas'
#@progress format   = [%d%s%p]
#@progress spinner  = -\\|/
#@progress done     = -
#@progress pending  =


# === Core settings ==========================================================

set useragent         = Uzbl (Webkit @WEBKIT_MAJOR.@WEBKIT_MINOR.@WEBKIT_MICRO) (@(+uname -o)@ @(+uname -m)@ [@ARCH_UZBL]) (Commit @COMMIT)
set useragent         = Mozilla/5.0 (X11; U; Linux i686; en-US) AppleWebKit/532.0 (KHTML, like Gecko) Chrome/3.0.196.0 Safari/532.0
set fifo_dir          = /tmp
set socket_dir        = /tmp

set disable_plugins = 1
set enable_spellcheck = 0
set scrollbars_visible = 0

# === Key modmapping and ignoring ============================================

#modmap <From>          <To>
@modmap <Control>       <Ctrl>
@modmap <ISO_Left_Tab>  <Shift-Tab>
@modmap <space>         <Space>

#modkey_addition <Key1>  <Key2>    <Result>
@modkey_addition <Shift> <Ctrl>    <Meta>
@modkey_addition <Shift> <Tab>     <Shift-Tab>

#ignore_key <glob>
@ignore_key <ISO_*>
@ignore_key <Shift>


# === Mode bind aliases ======================================================

# Global binding alias (this is done automatically inside the bind plugin).
#set bind = @mode_bind global

# Insert mode binding alias
set ibind = @mode_bind insert

# Command mode binding alias
set cbind = @mode_bind command

# Non-insert mode bindings alias (ebind for edit-bind).
set ebind = @mode_bind global,-insert


# === Global & keycmd editing binds ==========================================

# Resets keycmd and returns to default mode.
@bind   <Escape>     = @set_mode

# Commands for editing and traversing the keycmd.
@ebind  <Return>     = event KEYCMD_EXEC_CURRENT
@ebind  <Home>       = event SET_CURSOR_POS
@ebind  <End>        = event SET_CURSOR_POS -1
@ebind  <Left>       = event SET_CURSOR_POS -
@ebind  <Right>      = event SET_CURSOR_POS +
@ebind  <BackSpace>  = event KEYCMD_BACKSPACE
@ebind  <Delete>     = event KEYCMD_DELETE
@ebind  <Tab>        = event START_COMPLETION
# Readline-ish bindings.
@ebind  <Ctrl>w      = event KEYCMD_STRIP_WORD
@ebind  <Ctrl>u      = event SET_KEYCMD
@ebind  <Ctrl>a      = event SET_CURSOR_POS 0
@ebind  <Ctrl>e      = event SET_CURSOR_POS -1
@ebind  <Ctrl>v      = event APPEND_KEYCMD \@<document.getSelection()>\@
@ebind  <Ctrl>r = event APPEND_KEYCMD \@uri

# Keycmd injection/append examples.
#@ebind  <Ctrl>su = event INJECT_KEYCMD \@uri
#@ebind  <Ctrl>st = event INJECT_KEYCMD \@title
#@ebind  <Ctrl>du = event APPEND_KEYCMD \@uri
#@ebind  <Ctrl>dt = event APPEND_KEYCMD \@title


# === Mouse bindings =========================================================

# Middle click open in new window
@bind  <Button2>  = sh 'if [ "\@SELECTED_URI" ]; then uzbl-browser -g m "\@SELECTED_URI"; else echo "uri $(xclip -o)" > $4; fi'


# === Keyboard bindings ======================================================

# With this command you can enter in any command at runtime when prefixed with
# a colon.
@cbind    :_        = %s

# --- Page movement binds ---
@cbind  j            = scroll vertical 20
@cbind  k            = scroll vertical -20
@cbind  h            = scroll horizontal -20
@cbind  l            = scroll horizontal 20
@cbind  J            = scroll vertical 100%
@cbind  K            = scroll vertical -100%
@cbind  H            = scroll horizontal -100%
@cbind  L            = scroll horizontal 100%
@cbind  <Page_Up>    = scroll vertical -100%
@cbind  <Page_Down>  = scroll vertical 100%
@cbind  <            = scroll vertical begin
@cbind  >            = scroll vertical end
@cbind  ^            = scroll horizontal begin
@cbind  $            = scroll horizontal end
@cbind  <Space>      = scroll vertical 100%

# --- Navigation binds ---
@cbind  b   = back
@cbind  m   = forward
@cbind  S   = stop
@cbind  r   = reload
@cbind  R   = reload_ign_cache

# --- Zoom binds ---
@cbind  +   = chain "zoom_in" "sh echo \@zoom_level"
@cbind  -   = zoom_out
@cbind  T   = toggle_zoom_type
@cbind  1   = set zoom_level = 1.0
@cbind  2   = set zoom_level = 2.0

# --- Appearance binds ---
@cbind  t   = toggle_status

# --- Page searching binds ---
@cbind  /*  = search %s
@cbind  ?*  = search_reverse %s
# Jump to next and previous items
@cbind  n   = search
@cbind  N   = search_reverse

# --- Uzbl tabbed binds ---
# Tab opening
@cbind  gn              = event NEW_TAB
@cbind  go<uri:>_       = event NEW_TAB %s
@cbind  gY              = sh 'echo "event NEW_TAB `xclip -selection primary -o`" > $4'
# Closing / resting
@cbind  gC              = exit
@cbind  gQ              = event CLEAN_TABS
# Tab navigating
@cbind  g<              = event FIRST_TAB
@cbind  g>              = event LAST_TAB
@cbind  gt              = event NEXT_TAB
@cbind  gT              = event PREV_TAB
@cbind  gi<index:>_     = event GOTO_TAB %s
# Preset loading
set preset = event PRESET_TABS
@cbind  gs<preset save:>_   = @preset save %s
@cbind  glo<preset load:>_  = @preset load %s
@cbind  gd<preset del:>_    = @preset del %s
@cbind  gli                 = @preset list

# --- Web searching binds ---
@cbind  g<:>_               = uri http://www.google.com/search?q=\@<encodeURIComponent(%r)>\@
@cbind  G<:\@(xclip -o)\@>_ = uri http://www.google.com/search?q=\@<encodeURIComponent(%r)>\@
@cbind  \\awiki<Archwiki:>_ = uri http://wiki.archlinux.org/index.php/Special:Search?search=\@<encodeURIComponent(%r)>\@&go=Go
@cbind  w<:>_               = uri http://en.wikipedia.org/w/index.php?title=Special:Search&search=\@<encodeURIComponent(%r)>\@&go=Go
@cbind  qg<:>_  = js var d = document.createElement('div');d.innerHTML = '<form action="https://ssl.scroogle.org/cgi-bin/nbbwssl.cgi" method="POST" id="scroogle"><input type="hidden" name="Gw" value="%s" /></form>'; document.body.appendChild(d); document.forms['scroogle'].submit();

# --- Handy binds ---
# Set function shortcut
#@cbind  s<var:>_<value:>_  = set %1 = %2
# Exit binding
@cbind  d                  = chain 'spawn /root/.config/uzbl/exit.sh' 'exit'
@cbind  D                  = spawn /root/.config/uzbl/exitundo.sh
# Dump config to stdout
@cbind  !dump              = sh "echo dump_config > $4"
# Reload config
@cbind  !reload            = sh "sed '/^# === Post-load misc commands/,$d' $1 > $4"
# Uzbl Terminal. TODO explain why this is useful
#@cbind  <Ctrl><Alt>t  = sh 'xterm -e "socat unix-connect:$5 -"'
@cbind  <Ctrl><Alt>t  = sh 'urxvt -e socat unix-connect:$5 -'

# --- Uri opening prompts ---
@cbind  o<:>_          = script /root/.config/uzbl/intelo.js '%s'
# Or have it load the current uri into the keycmd for editing
@cbind  O<uri:\@uri>_  = uri %s

# --- Mode setting binds ---
# Changing mode via  set.
@cbind  I  = chain 'script /root/.config/uzbl/gi.js' '@set_mode insert'
# Or toggle between modes by raising the toggle event.
set toggle_cmd_ins = @toggle_modes command insert
@cbind  i          = @toggle_cmd_ins
# And the global toggle bind.
@bind   <Ctrl>i    = @toggle_cmd_ins

# --- Hard-bound bookmarks ---
@cbind  0   = uri http://google.com/ig

# --- Yanking & pasting binds ---
@cbind  y   = sh 'echo -n $6 | xclip'
#@cbind  yy  = sh 'echo -n $7 | xclip'

# Go the page from primary selection
@cbind  p   = sh 'echo "uri `xclip -selection primary -o`" > $4'
# Go to the page in clipboard
@cbind  P   = sh 'echo "uri `xclip -selection clipboard -o`" > $4'
# Start a new uzbl instance from the page in primary selection
@cbind  'p  = sh 'exec uzbl-browser --uri $(xclip -o)'

# --- Bookmark inserting binds ---
@cbind <Ctrl>b<tags:>_  = sh 'echo -e "$6 %s" >> $XDG_DATA_HOME/uzbl/bookmarks'
# Or use a script to insert a bookmark.
@cbind  B  = spawn @scripts_dir/insert_bookmark.sh

# --- Bookmark/history loading ---
@cbind  U  = spawn @scripts_dir/load_url_from_history.sh
@cbind  u  = spawn @scripts_dir/load_url_from_bookmarks.sh

# --- Link following (similar to vimperator and konqueror) ---
# Set custom keys you wish to use for navigation. Some common examples:
set follow_hint_keys = 0123456789
set follow_hint_keys = jfkdurmc
#set follow_hint_keys = qwerty
#set follow_hint_keys = asdfghjkl;
#set follow_hint_keys = thsnd-rcgmvwb/;789aefijkopquxyz234
@cbind  f*             = script /root/.config/uzbl/follow.js '@follow_hint_keys %s'
@cbind  F*             = script /root/.config/uzbl/followNewWin.js '@follow_hint_keys %s'
@cbind  s              = spawn /root/.config/uzbl/follow-dmenu.pl
@cbind  <Ctrl><Return> = script /root/.config/uzbl/followSelected.js

@cbind  <Ctrl>u = sh 'echo "uri $(dirname $6)" > $4'
@cbind  ]       = script /root/.config/uzbl/next.js
@cbind  [       = script /root/.config/uzbl/prev.js
@cbind  ql      = set uri = \@{uri}?logout&logout
@cbind  qa      = js uzblAdBlock();
@cbind  qs      = chain 'set disable_scripts = 1' 'reload'
@cbind  qp      = chain 'set disable_plugins = 1' 'reload'
@cbind  qS      = chain 'set disable_scripts = 0' 'reload'
@cbind  qP      = chain 'set disable_plugins = 0' 'reload'

# --- Form filler binds ---
# this script allows you to configure (per domain) values to fill in form
# fields (eg login information) and to fill in these values automatically
set formfiller = spawn @scripts_dir/formfiller
@cbind  za  = @{formfiller}.sh
@cbind  ze  = @{formfiller}.sh edit
@cbind  zn  = @{formfiller}.sh new
@cbind  zl  = @{formfiller}.sh load
# Or the more advanced implementation using perl: (could not get this to run - Dieter)
#@cbind  LL  = @{formfiller}.pl load
#@cbind  LN  = @{formfiller}.pl new
#@cbind  LE  = @{formfiller}.pl edit

# --- External edit script configuration & binds ---
# Edit form input fields in an external editor (gvim, emacs, urxvt -e vim, ..)
set external_editor = gvim
#set external_editor = xterm -e vim
@cbind  E  = script /root/.config/uzbl/extedit.js
# And add menu option.
menu_editable_add Open in @external_editor = script /root/.config/uzbl/extedit.js
@cbind  v  = sh 'echo "js document.documentElement.outerHTML" | socat - unix-connect:$5 | gvim -'

# --- Examples ---
# Example showing how to use uzbl's fifo to execute a command.
#@bind  X1 = sh 'echo "set zoom_level = 1.0" > "$4"'
#@bind  X2 = sh 'echo "js alert (\\"This is sent by the shell via a fifo\\")" > "$4"'


# === Context menu items =====================================================

# Default context menu
menu_add Google = set uri = http://google.com
menu_add Go Home = set uri = http://google.com/ig
menu_separator separator_1
menu_add Quit uzbl = exit

# Link context menu
menu_link_add Print Link = print \@SELECTED_URI


# === Mode configuration =====================================================

# Define some mode specific uzbl configurations.
set command  = @mode_config command
set insert   = @mode_config insert
set stack    = @mode_config stack

# Command mode config.
@command  keycmd_style        = foreground="red"
@command  status_background   = black
@command  mode_indicator      = C

# Insert mode config.
@insert   status_background   = #505050
@insert   mode_indicator      = I

# Multi-stage-binding mode config.
@stack    keycmd_events       = 1
@stack    modcmd_updates      = 1
@stack    forward_keys        = 0
@stack    keycmd_style        = foreground="red"
@stack    prompt_style        = foreground="#888" weight="light"
@stack    status_background   = #502020
@stack    mode_indicator      = B

set default_mode = command


# === Post-load misc commands  ===============================================

toggle_zoom_type
set zoom_level = 2.0
# Set the "home" page.
#set uri = uzbl.org/doesitwork/@COMMIT
